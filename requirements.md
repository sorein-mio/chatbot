# チャットボット機能要件定義書

## 1. システム概要

### 1.1 目的
- OpenAI APIを活用したインタラクティブなチャットボットインターフェースの提供
- ユーザーとAI間のシームレスな対話環境の実現
- マークダウン形式でのリッチテキスト応答のサポート

### 1.2 システム構成
- フロントエンド: React + TypeScript
- 外部API: OpenAI API
- UI: レスポンシブデザイン（ズーム機能対応）

## 2. 機能要件

### 2.1 基本機能
1. チャット機能
   - ユーザーメッセージの送信
   - AIからの応答受信
   - 会話履歴の表示
   - マークダウン形式での応答表示

2. モデル選択機能
   - 利用可能なモデル
     - gpt-4o
     - gpt-4o-mini
     - gpt-3.5-turbo
   - 動的なモデル切り替え

3. UI制御機能
   - ウィンドウサイズの切り替え（middle/large）
   - 自動スクロール
   - ローディング表示

### 2.2 UI要件
1. ヘッダー部分
   - モデル選択ドロップダウン
   - ズーム切り替えボタン

2. メイン部分
   - チャット履歴表示エリア
   - ユーザーメッセージ（右側配置）
   - AI応答（左側配置）
   - スクロール可能な会話履歴

3. フッター部分
   - メッセージ入力フィールド
   - 送信ボタン
   - ローディングインジケーター

## 3. 非機能要件

### 3.1 パフォーマンス要件
- APIレスポンスのエラーハンドリング
- ローディング状態の適切な表示
- スムーズなスクロール動作

### 3.2 セキュリティ要件
- OpenAI APIキーの安全な管理
- APIリクエストの適切な認証

### 3.3 ユーザビリティ要件
- Enter キーでのメッセージ送信
- 空メッセージの送信防止
- 会話履歴の自動スクロール
- 画面サイズに応じた表示調整

## 4. 技術要件

### 4.1 使用技術
- React
- TypeScript
- Axios（HTTP通信）
- Marked（マークダウンパーサー）

### 4.2 状態管理
1. アプリケーション状態
   - チャットボットのサイズ状態
   - 選択中のモデル
   - 会話履歴
   - 入力テキスト
   - ローディング状態

2. DOM参照
   - チャットリスト
   - チャットボット本体

### 4.3 API仕様
- エンドポイント: https://api.openai.com/v1/chat/completions
- リクエストヘッダー:
  - Content-Type: application/json
  - Authorization: Bearer {API_KEY}
- リクエストパラメータ:
  - model: 使用するモデル名
  - messages: プロンプト情報
  - temperature: 応答の多様性（0.5固定）

## 5. エラーハンドリング

### 5.1 想定されるエラー
1. API通信エラー
   - ネットワークエラー
   - 認証エラー
   - レスポンスエラー

2. ユーザー操作エラー
   - 空メッセージの送信試行

### 5.2 エラー対応
- エラーメッセージの表示
- エラーログの出力
- ユーザーフレンドリーなエラー通知

## 6. ファイル構成

### 6.1 プロジェクト構造
```
/
├── dist/             # ビルド出力ディレクトリ
├── src/              # ソースコードディレクトリ
│   ├── index.tsx     # Reactアプリケーションのエントリーポイント
│   ├── components/   # Reactコンポーネント
│   │   └── Chatbot.tsx  # チャットボットメインコンポーネント
│   ├── config/      # 設定ファイル
│   │   └── models.ts   # モデル設定
│   └── styles/       # コンポーネント固有のスタイル
│       └── Chatbot.css  # チャットボットのスタイル
├── .env.example      # 環境変数テンプレート
├── .env             # 環境変数（非公開）
├── .gitignore       # Git除外設定
├── package.json     # プロジェクト設定・依存関係
├── package-lock.json # 依存関係のロックファイル
├── README.md        # プロジェクト説明
├── requirements.md  # 要件定義
├── tsconfig.json    # TypeScript設定
└── webpack.config.js # Webpack設定
```

### 6.2 主要ファイルの役割

1. **設定ファイル**
   - package.json: プロジェクトの依存関係と設定
   - tsconfig.json: TypeScriptコンパイラ設定
   - webpack.config.js: ビルド設定
   - .env: 環境変数（APIキーなど）
   - .env.example: 環境変数のテンプレート

2. **アプリケーションコード**
   - src/index.tsx: Reactアプリケーションの初期化
   - src/components/Chatbot.tsx: チャットボットのメイン実装
   - src/config/models.ts: 利用可能なモデルの設定
   - src/styles/Chatbot.css: チャットボット固有のスタイル

3. **ドキュメント**
   - README.md: プロジェクトの説明と使用方法
   - requirements.md: 詳細な要件定義

## 7. 拡張性

### 7.1 将来的な拡張可能性
- 追加のGPTモデルサポート
- チャット履歴の永続化
- プロンプトテンプレート機能
- ファイル添付機能
- 会話コンテキストの保持機能の強化
